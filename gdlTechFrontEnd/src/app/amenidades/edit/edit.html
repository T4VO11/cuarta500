<div class="container mt-4">
    <button class="btn btn-secondary mb-4" (click)="regresar()">
        <i class="bi bi-arrow-left"></i> Regresar a Lista de Amenidades
    </button>
    
    <div *ngIf="isLoading" class="alert alert-info">Cargando datos de la amenidad...</div>
    <div *ngIf="errorMessage" class="alert alert-danger">{{ errorMessage }}</div>

    <div *ngIf="amenidadAEditar" class="card p-4 shadow-sm">
        <h3 class="card-title">
            Editar Amenidad: {{ amenidadAEditar.nombre }} (ID: {{ amenidadAEditar.amenidad_id }})
        </h3>  
      
        <form (ngSubmit)="submitAmenidadForm()">
           <h4 class="mt-4 mb-3 border-top pt-3">Información General</h4>
<div class="row mb-3">
    <div class="col-md-3">
        <label for="amenidad_id" class="form-label">ID Amenidad</label>
        <input type="number" class="form-control" [(ngModel)]="amenidadAEditar.amenidad_id" name="amenidad_id" required>
    </div>
    <div class="col-md-3">
        <label for="condominio_id" class="form-label">ID Condominio</label>
        <input type="text" class="form-control" [(ngModel)]="amenidadAEditar.condominio_id" name="condominio_id" disabled>
    </div>
    <div class="col-md-3">
        <label for="nombre" class="form-label">Nombre</label>
        <input type="text" class="form-control" [(ngModel)]="amenidadAEditar.nombre" name="nombre" required>
    </div>
    <div class="col-md-3">
        <label for="tipo" class="form-label">Tipo</label>
        <input type="text" class="form-control" [(ngModel)]="amenidadAEditar.tipo" name="tipo" required>
    </div>
</div>
<div class="row mb-3">
    <div class="col-md-9">
        <label for="descripcion" class="form-label">Descripción</label>
        <textarea class="form-control" [(ngModel)]="amenidadAEditar.descripcion" name="descripcion" required></textarea>
    </div>
    <div class="col-md-3">
        <label for="estado" class="form-label">Estado</label>
        <select class="form-control" [(ngModel)]="amenidadAEditar.estado" name="estado">
            <option value="activo">Activo</option>
            <option value="inactivo">Inactivo</option>
            <option value="mantenimiento">Mantenimiento</option>
        </select>
    </div>
</div>

<h4 class="mt-4 mb-3 border-top pt-3">Detalles de Costo y Categoría</h4>
<div class="row mb-3">
    <div class="col-md-4">
        <label for="precio" class="form-label">Precio ($)</label>
        <input type="number" class="form-control" [(ngModel)]="amenidadAEditar.catalogo_detalle.precio" name="precio" required>
    </div>
    <div class="col-md-4">
        <label for="categoria" class="form-label">Categoría</label>
        <input type="text" class="form-control" [(ngModel)]="amenidadAEditar.catalogo_detalle.categoria" name="categoria" required>
    </div>
    <div class="col-md-4">
        <label for="motivo" class="form-label">Motivo (Uso)</label>
        <input type="text" class="form-control" [(ngModel)]="amenidadAEditar.catalogo_detalle.motivo" name="motivo">
    </div>
</div>

<h4 class="mt-4 mb-3 border-top pt-3">Reglas de Reserva</h4>
<div class="row mb-4">
    <div class="col-md-3">
        <label for="costo_apartado" class="form-label">Costo Apartado ($)</label>
        <input type="number" class="form-control" [(ngModel)]="amenidadAEditar.reglas_apartado.costo_apartado" name="costo_apartado" required>
    </div>
    <div class="col-md-3">
        <label for="capacidad_maxima" class="form-label">Capacidad Máx.</label>
        <input type="number" class="form-control" [(ngModel)]="amenidadAEditar.reglas_apartado.capacidad_maxima" name="capacidad_maxima" required>
    </div>
    <div class="col-md-3">
        <label for="horario_maximo_horas" class="form-label">Máx. Horas/Reserva</label>
        <input type="number" class="form-control" [(ngModel)]="amenidadAEditar.reglas_apartado.horario_maximo_horas" name="horario_maximo_horas">
    </div>
    <div class="col-md-3">
        <label for="dias_anticipacion" class="form-label">Días de Aviso</label>
        <input type="number" class="form-control" [(ngModel)]="amenidadAEditar.reglas_apartado.dias_anticipacion" name="dias_anticipacion" required>
    </div>
</div>
<div class="row mb-4">
    <div class="col-md-3">
        <label for="horario_inicio" class="form-label">Horario Inicio</label>
        <input type="time" class="form-control" [(ngModel)]="amenidadAEditar.reglas_apartado.horario_inicio" name="horario_inicio" required>
    </div>
    <div class="col-md-3">
        <label for="horario_fin" class="form-label">Horario Fin</label>
        <input type="time" class="form-control" [(ngModel)]="amenidadAEditar.reglas_apartado.horario_fin" name="horario_fin" required>
    </div>
</div>
            
            <h4 class="mt-4">Galería de Imágenes Actual ({{ amenidadAEditar.reglas_apartado?.galeria_urls?.length || 0 }})</h4>
            <div class="row mb-4">
                <div class="col-md-2 mb-3" 
                     *ngFor="let url of amenidadAEditar.reglas_apartado?.galeria_urls">
                    <div class="card p-1 text-center">
                        <img [src]="url" 
                             alt="Foto Galería" 
                             class="img-fluid rounded" 
                             style="height: 100px; object-fit: cover;">
                        <button type="button" 
                                class="btn btn-sm btn-danger mt-1" 
                                (click)="removerImagen(url)">
                            <i class="bi bi-trash"></i> Quitar
                        </button>
                    </div>
                </div>
            </div>
            
            <h4 class="mt-4">Subir Nuevas Imágenes a la Galería</h4>
            <div class="mb-3">
                <input name="galeria_urls" 
                type="file" 
                 (change)="onFileSelected($event)" 
                 multiple 
                 accept="image/*" 
                 class="form-control">

                <small class="text-muted">Selecciona nuevas imágenes. Las anteriores se mantendrán a menos que las quites.</small>
            </div>


            <div class="mt-4 d-flex justify-content-end">
                <button type="submit" class="btn btn-success me-2">
                    <i class="bi bi-save"></i> Guardar Cambios
                </button>
            </div>
        </form>
    </div>
</div>