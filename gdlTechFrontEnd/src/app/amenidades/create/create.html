<div class="container mt-4">
    <a class="btn btn-success mb-4" [routerLink]="['/main/amenidades']">
        <i class="bi bi-arrow-left"></i> Regresar a Lista de Amenidades
    </a>

    <div class="card p-4 mb-4 shadow-lg">
        <h3 class="card-title mb-4 border-bottom pb-2">Crear Nueva Amenidad</h3>
        
        <form (ngSubmit)="submitAmenidadForm()" #amenidadForm="ngForm">
            
           <h4 class="mt-4 mb-3 border-top pt-3">Información General</h4>
<div class="row mb-3">
    <div class="col-md-3">
        <label for="amenidad_id" class="form-label">ID Amenidad</label>
        <input type="number" class="form-control" [(ngModel)]="nuevaAmenidad.amenidad_id" name="amenidad_id" required>
    </div>
    <div class="col-md-3">
        <label for="condominio_id" class="form-label">ID Condominio</label>
        <input type="text" class="form-control" [(ngModel)]="nuevaAmenidad.condominio_id" name="condominio_id" disabled>
    </div>
    <div class="col-md-3">
        <label for="nombre" class="form-label">Nombre</label>
        <input type="text" class="form-control" [(ngModel)]="nuevaAmenidad.nombre" name="nombre" required>
    </div>
    <div class="col-md-3">
        <label for="tipo" class="form-label">Tipo</label>
        <input type="text" class="form-control" [(ngModel)]="nuevaAmenidad.tipo" name="tipo" required>
    </div>
</div>
<div class="row mb-3">
    <div class="col-md-9">
        <label for="descripcion" class="form-label">Descripción</label>
        <textarea class="form-control" [(ngModel)]="nuevaAmenidad.descripcion" name="descripcion" required></textarea>
    </div>
    <div class="col-md-3">
        <label for="estado" class="form-label">Estado</label>
        <select class="form-control" [(ngModel)]="nuevaAmenidad.estado" name="estado">
            <option value="activo">Activo</option>
            <option value="inactivo">Inactivo</option>
            <option value="mantenimiento">Mantenimiento</option>
        </select>
    </div>
</div>

<h4 class="mt-4 mb-3 border-top pt-3">Detalles de Costo y Categoría</h4>
<div class="row mb-3">
    <div class="col-md-4">
        <label for="precio" class="form-label">Precio ($)</label>
        <input type="number" class="form-control" [(ngModel)]="nuevaAmenidad.catalogo_detalle.precio" name="precio" required>
    </div>
    <div class="col-md-4">
        <label for="categoria" class="form-label">Categoría</label>
        <input type="text" class="form-control" [(ngModel)]="nuevaAmenidad.catalogo_detalle.categoria" name="categoria" required>
    </div>
    <div class="col-md-4">
        <label for="motivo" class="form-label">Motivo (Uso)</label>
        <input type="text" class="form-control" [(ngModel)]="nuevaAmenidad.catalogo_detalle.motivo" name="motivo">
    </div>
</div>

<h4 class="mt-4 mb-3 border-top pt-3">Reglas de Reserva</h4>
<div class="row mb-4">
    <div class="col-md-3">
        <label for="costo_apartado" class="form-label">Costo Apartado ($)</label>
        <input type="number" class="form-control" [(ngModel)]="nuevaAmenidad.reglas_apartado.costo_apartado" name="costo_apartado" required>
    </div>
    <div class="col-md-3">
        <label for="capacidad_maxima" class="form-label">Capacidad Máx.</label>
        <input type="number" class="form-control" [(ngModel)]="nuevaAmenidad.reglas_apartado.capacidad_maxima" name="capacidad_maxima" required>
    </div>
    <div class="col-md-3">
        <label for="horario_maximo_horas" class="form-label">Máx. Horas/Reserva</label>
        <input type="number" class="form-control" [(ngModel)]="nuevaAmenidad.reglas_apartado.horario_maximo_horas" name="horario_maximo_horas">
    </div>
    <div class="col-md-3">
        <label for="dias_anticipacion" class="form-label">Días de Aviso</label>
        <input type="number" class="form-control" [(ngModel)]="nuevaAmenidad.reglas_apartado.dias_anticipacion" name="dias_anticipacion" required>
    </div>
</div>
<div class="row mb-4">
    <div class="col-md-3">
        <label for="horario_inicio" class="form-label">Horario Inicio</label>
        <input type="time" class="form-control" [(ngModel)]="nuevaAmenidad.reglas_apartado.horario_inicio" name="horario_inicio" required>
    </div>
    <div class="col-md-3">
        <label for="horario_fin" class="form-label">Horario Fin</label>
        <input type="time" class="form-control" [(ngModel)]="nuevaAmenidad.reglas_apartado.horario_fin" name="horario_fin" required>
    </div>
</div>

<h4 class="mt-4 mb-3 border-top pt-3 text-success">
        <i class="bi bi-cart-plus"></i> Servicios Extra (Opcional)
    </h4>
    
    <div class="card bg-light border-0 mb-4">
        <div class="card-body">
            <p class="text-muted small mb-3">
                Agrega aquí los elementos que se pueden rentar adicionalmente (Ej: Mesas, Sillas, Sonido). 
                Esto aparecerá en la app móvil al reservar.
            </p>

            <div class="table-responsive" *ngIf="nuevaAmenidad.reglas_apartado.extras_disponibles.length > 0">
                <table class="table table-bordered table-hover bg-white">
                    <thead class="table-secondary">
                        <tr>
                            <th style="width: 40%">Nombre del Servicio</th>
                            <th style="width: 25%">Costo ($)</th>
                            <th style="width: 25%">Descripción (Opcional)</th>
                            <th style="width: 10%" class="text-center">Acción</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let extra of nuevaAmenidad.reglas_apartado.extras_disponibles; let i = index">
                            <td>
                                <input type="text" class="form-control form-control-sm" 
                                       placeholder="Ej. Sillas Extra"
                                       name="extraNombre_{{i}}" 
                                       [(ngModel)]="extra.nombre" required>
                            </td>
                            <td>
                                <div class="input-group input-group-sm">
                                    <span class="input-group-text">$</span>
                                    <input type="number" class="form-control" 
                                           placeholder="0"
                                           name="extraCosto_{{i}}" 
                                           [(ngModel)]="extra.costo" required>
                                </div>
                            </td>
                            <td>
                                <input type="text" class="form-control form-control-sm" 
                                       placeholder="Detalles..."
                                       name="extraDesc_{{i}}" 
                                       [(ngModel)]="extra.descripcion">
                            </td>
                            <td class="text-center">
                                <button type="button" class="btn btn-outline-danger btn-sm" 
                                        (click)="eliminarServicioExtra(i)"
                                        title="Eliminar fila">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div *ngIf="nuevaAmenidad.reglas_apartado.extras_disponibles.length === 0" 
                 class="text-center p-3 border border-dashed rounded bg-white text-muted mb-3">
                <i class="bi bi-inbox fs-4 d-block mb-2"></i>
                No hay servicios extra configurados aún.
            </div>

            <button type="button" class="btn btn-outline-success" (click)="agregarServicioExtra()">
                <i class="bi bi-plus-circle-fill"></i> Agregar Nuevo Servicio Extra
            </button>
        </div>
    </div>

<h4 class="mt-4">Galería de Imágenes Actual ({{ selectedFiles.length }})</h4>
            <div class="row mb-4">
                <div class="col-md-2 mb-3" 
                     *ngFor="let preview of localPreviews">
                    <div class="card p-1 text-center">
                        <img [src]="preview.url" 
                             alt="Previa" 
                             class="img-fluid rounded" 
                             style="height: 100px; object-fit: cover;">
                        <button type="button" 
                                class="btn btn-sm btn-danger mt-1" 
                                >
                            <i class="bi bi-trash"></i> Quitar
                        </button>
                    </div>
                </div>
            </div>

            <div class="mb-4 border-top pt-3">
                <label for="galeria" class="form-label">Galería de Imágenes (Máx 10)</label>
                <input name="galeria_urls" 
                 type="file" 
                 multiple 
                 (change)="onFileSelected($event)" 
                 accept="image/*" 
                class="form-control">
                
                <small *ngIf="selectedFiles.length > 0" class="text-success mt-2">
                    {{ selectedFiles.length }} archivo(s) listo(s) para subir.
                </small>
            </div>
            
            <div class="d-flex justify-content-end">
                <button type="submit" class="btn btn-success" [disabled]="!amenidadForm.valid">
                    <i class="bi bi-save"></i> Guardar Amenidad
                </button>
            </div>
        </form>
    </div>
</div>